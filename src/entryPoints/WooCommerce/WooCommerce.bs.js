// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Button from "../../components/Button.bs.js";
import * as Recoil from "recoil";
import * as LogicUtils from "../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as GatewayIcon from "../../components/custom-icons/GatewayIcon.bs.js";
import * as ConnectorUtils from "../../screens/Connectors/ConnectorUtils.bs.js";
import * as GlobalProvider from "../Provider/GlobalProvider.bs.js";
import * as SetupConnector from "../../screens/Home/CommonConnectorFlow/SetupConnector.bs.js";
import * as EnumVariantHook from "../../screens/Hooks/EnumVariantHook.bs.js";
import * as HyperswitchAtom from "../../Recoils/HyperswitchAtom.bs.js";
import * as PaymentSettings from "../../screens/Developer/PaymentSettings/PaymentSettings.bs.js";
import * as QuickStartUtils from "../../screens/Home/QuickStart/QuickStartUtils.bs.js";
import * as ConnectorPreview from "../../screens/Connectors/ConnectorPreview.bs.js";
import * as WooCommerceUtils from "./WooCommerceUtils.bs.js";
import * as HSwitchGlobalVars from "../../utils/HSwitchGlobalVars.bs.js";
import * as QuickStartUIUtils from "../../screens/Home/QuickStart/QuickStartUIUtils.bs.js";
import * as HSSelfServeSidebar from "../../screens/Utils/HSSelfServeSidebar.bs.js";
import * as WooCommerceUIUtils from "./WooCommerceUIUtils.bs.js";
import * as ConnectorListMapper from "../../utils/Mappers/ConnectorListMapper.bs.js";
import * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";
import * as MerchantAccountUtils from "../../screens/Settings/MerchantAccountUtils.bs.js";
import * as ProdOnboardingUIUtils from "../../screens/SelfServe/HSwitchProdOnboarding/ProdOnboardingUIUtils.bs.js";
import * as UserOnboardingUIUtils from "../../screens/SelfServe/HSwitchSandboxOnboarding/UserOnboardingUIUtils.bs.js";

var steps = [
  /* PLUGIN_INSTALL */ 0, /* PLUGIN_CONFIGURE */ 1, /* WEBHOOK_SETUP */ 2,
  /* PROCESSOR_SETUP */ 3,
];

function WooCommerce$BaseComponent(props) {
  var handleNavigation = props.handleNavigation;
  return React.createElement(QuickStartUIUtils.BaseComponent.make, {
    children: props.children,
    headerText: "Hyperswitch for Woocommerce",
    headerLeftIcon: "hyperswitch-logo-short",
    nextButton: Caml_option.some(
      React.createElement(Button.make, {
        text: "Continue",
        buttonType: /* Primary */ 0,
        onClick: function (param) {
          Curry._1(handleNavigation, true);
        },
      }),
    ),
  });
}

var BaseComponent = {
  make: WooCommerce$BaseComponent,
};

function WooCommerce$WooCommerceStepWrapper(props) {
  return React.createElement(
    "div",
    {
      className: "flex flex-col gap-6",
    },
    React.createElement(
      "div",
      undefined,
      React.createElement(
        "h2",
        {
          className: "text-xl font-semibold",
        },
        props.title,
      ),
      React.createElement(
        "p",
        {
          className: "text-gray-500",
        },
        props.description,
      ),
    ),
    props.children,
  );
}

var WooCommerceStepWrapper = {
  make: WooCommerce$WooCommerceStepWrapper,
};

function WooCommerce$InstallPlugin(props) {
  return React.createElement(WooCommerce$BaseComponent, {
    handleNavigation: props.handleNavigation,
    children: React.createElement(WooCommerce$WooCommerceStepWrapper, {
      title: props.title,
      description: props.description,
      children: React.createElement(
        "div",
        {
          className: "bg-gray-50 rounded border p-8 flex flex-col gap-6",
        },
        React.createElement(
          "div",
          undefined,
          React.createElement(
            "h2",
            {
              className: "text-xl font-medium",
            },
            "Hyperswitch's Checkout Plugin",
          ),
          React.createElement(
            "p",
            {
              className: "text-gray-500",
            },
            "Use this plugin to get the best checkout experience",
          ),
        ),
        React.createElement(
          UserOnboardingUIUtils.DownloadWordPressPlugin.make,
          {
            currentRoute: /* WooCommercePlugin */ 3,
            currentTabName: "downloadWordpressPlugin",
          },
        ),
      ),
    }),
  });
}

var InstallPlugin = {
  make: WooCommerce$InstallPlugin,
};

function WooCommerce$ConfigurePlugin(props) {
  return React.createElement(WooCommerce$BaseComponent, {
    handleNavigation: props.handleNavigation,
    children: React.createElement(WooCommerce$WooCommerceStepWrapper, {
      title: props.title,
      description: props.description,
      children: React.createElement(
        "div",
        {
          className: "p-8 flex flex-col gap-6",
        },
        React.createElement(
          "div",
          {
            className: "flex flex-col gap-6",
          },
          React.createElement(
            "div",
            {
              className: "flex gap-2 items-center",
            },
            React.createElement(
              "div",
              {
                className:
                  "text-grey-0 bg-gray-700 rounded flex items-center px-1",
              },
              "1",
            ),
            React.createElement(
              "h2",
              {
                className: "font-medium",
              },
              "Navigate to WooCommerce Settings > Payments Tab",
            ),
          ),
          React.createElement(
            "div",
            {
              className:
                "bg-white p-7 flex flex-col gap-6 border !shadow-hyperswitch_box_shadow rounded-md",
            },
            React.createElement("img", {
              style: {
                height: "400px",
                width: "100%",
                objectFit: "cover",
                objectPosition: "0% 12%",
              },
              src: "https://hyperswitch.io/img/site/wordpress_hyperswitch_settings.png",
            }),
          ),
        ),
        React.createElement(
          "div",
          {
            className: "flex flex-col gap-6",
          },
          React.createElement(
            "div",
            {
              className: "flex gap-2 items-center",
            },
            React.createElement(
              "div",
              {
                className:
                  "text-grey-0 bg-gray-700 rounded flex items-center px-1",
              },
              "2",
            ),
            React.createElement(
              "h2",
              {
                className: "font-medium",
              },
              "Copy-Paste your API keys & below details in your WooCommerce Plugin Settings",
            ),
          ),
          React.createElement(
            "div",
            {
              className: "bg-gray-50 p-7",
            },
            React.createElement(
              "div",
              {
                className: "grid grid-cols-3 w-full border-b py-4",
              },
              React.createElement(
                "div",
                {
                  className: "col-span-2",
                },
                React.createElement(
                  "div",
                  {
                    className: "font-medium",
                  },
                  "API Key",
                ),
                React.createElement(
                  "div",
                  {
                    className: "text-gray-500 mt-2",
                  },
                  "Use this key to authenticate all API requests from your application's server",
                ),
              ),
              React.createElement(
                UserOnboardingUIUtils.DownloadAPIKeyButton.make,
                {
                  buttonText: "Download API key",
                  currentRoute: /* WooCommercePlugin */ 3,
                  currentTabName: "downloadWordpressPlugin",
                },
              ),
            ),
            React.createElement(
              "div",
              {
                className: "grid grid-cols-3 w-full border-b py-4",
              },
              React.createElement(
                "div",
                {
                  className: "col-span-2",
                },
                React.createElement(
                  "div",
                  {
                    className: "font-medium",
                  },
                  "Publishable Key",
                ),
                React.createElement(
                  "div",
                  {
                    className: "text-gray-500 mt-2",
                  },
                  "Use this key to authenticate all calls from your application's client",
                ),
              ),
              React.createElement(
                UserOnboardingUIUtils.PublishableKeyArea.make,
                {},
              ),
            ),
            React.createElement(
              "div",
              {
                className: "grid grid-cols-3 w-full py-4",
              },
              React.createElement(
                "div",
                {
                  className: "col-span-2",
                },
                React.createElement(
                  "div",
                  {
                    className: "font-medium",
                  },
                  "Payment Response Hash Key",
                ),
                React.createElement(
                  "div",
                  {
                    className: "text-gray-500 mt-2",
                  },
                  "This helps to authenticate and verify live events send by Hyperswitch.",
                ),
              ),
              React.createElement(
                UserOnboardingUIUtils.PaymentResponseHashKeyArea.make,
                {},
              ),
            ),
          ),
        ),
      ),
    }),
  });
}

var ConfigurePlugin = {
  make: WooCommerce$ConfigurePlugin,
};

function WooCommerce$ConfigureWebHook(props) {
  var businessProfiles = Recoil.useRecoilValue(
    HyperswitchAtom.businessProfilesAtom,
  );
  var defaultBusinessProfile =
    MerchantAccountUtils.getValueFromBusinessProfile(businessProfiles);
  return React.createElement(WooCommerce$BaseComponent, {
    handleNavigation: props.handleNavigation,
    children: React.createElement(WooCommerce$WooCommerceStepWrapper, {
      title: props.title,
      description: props.description,
      children: React.createElement(
        "div",
        {
          className: "p-8 flex flex-col gap-6",
        },
        React.createElement(
          "div",
          {
            className: "flex flex-col gap-6",
          },
          React.createElement(
            "div",
            {
              className: "flex gap-2 items-center",
            },
            React.createElement(
              "div",
              {
                className:
                  "text-grey-0 bg-gray-700 rounded flex items-center px-1",
              },
              "1",
            ),
            React.createElement(
              "h2",
              {
                className: "font-medium",
              },
              "Enable Hyperswitch Webhook in “Enable Webhook” Section (Ignore if enabled)",
            ),
          ),
          React.createElement(
            "div",
            {
              className:
                "bg-white p-7 flex flex-col gap-6 border !shadow-hyperswitch_box_shadow rounded-md",
            },
            React.createElement("img", {
              style: {
                height: "250px",
                width: "100%",
                objectFit: "cover",
                objectPosition: "0% 40%",
              },
              src: "https://hyperswitch.io/img/site/wordpress_hyperswitch_settings.png",
            }),
          ),
        ),
        React.createElement(
          "div",
          {
            className: "flex flex-col gap-6",
          },
          React.createElement(
            "div",
            {
              className: "flex gap-2 items-center",
            },
            React.createElement(
              "div",
              {
                className:
                  "text-grey-0 bg-gray-700 rounded flex items-center px-1",
              },
              "2",
            ),
            React.createElement(
              "h2",
              {
                className: "font-medium",
              },
              "Copy the URL under “Enable Webhook” section & paste here",
            ),
          ),
          React.createElement(
            "div",
            {
              className: "bg-gray-50 p-7",
            },
            React.createElement(
              "div",
              {
                className: "grid grid-cols-2 w-full py-4",
              },
              React.createElement(
                "div",
                undefined,
                React.createElement(
                  "div",
                  {
                    className: "font-medium",
                  },
                  "API Key",
                ),
                React.createElement(
                  "div",
                  {
                    className: "text-gray-500 mt-2",
                  },
                  "Use this key to authenticate all API requests from your application's server",
                ),
              ),
              React.createElement(PaymentSettings.make, {
                webhookOnly: true,
                showFormOnly: true,
                profileId: defaultBusinessProfile.profile_id,
              }),
            ),
          ),
        ),
        React.createElement(
          "div",
          {
            className: "flex flex-col gap-6",
          },
          React.createElement(
            "div",
            {
              className: "flex gap-2 items-center",
            },
            React.createElement(
              "div",
              {
                className:
                  "text-grey-0 bg-gray-700 rounded flex items-center px-1",
              },
              "3",
            ),
            React.createElement(
              "h2",
              {
                className: "font-medium",
              },
              'Scroll to the bottom & click on "Save Changes"',
            ),
          ),
          React.createElement(
            "div",
            {
              className:
                "bg-white p-7 flex flex-col gap-6 border !shadow-hyperswitch_box_shadow rounded-md",
            },
            React.createElement("img", {
              style: {
                height: "150px",
                width: "100%",
                objectFit: "cover",
                objectPosition: "0% 100%",
              },
              src: "https://hyperswitch.io/img/site/wordpress_hyperswitch_settings.png",
            }),
          ),
        ),
      ),
    }),
  });
}

var ConfigureWebHook = {
  make: WooCommerce$ConfigureWebHook,
};

function WooCommerce(props) {
  var usePostEnumDetails = EnumVariantHook.usePostEnumDetails(undefined);
  var enumDetails = Recoil.useRecoilValue(HyperswitchAtom.enumVariantAtom);
  var match = React.useState(function () {
    return {
      TAG: /* UnknownConnector */ 2,
      _0: "",
    };
  });
  var selectedConnector = match[0];
  var match$1 = React.useState(function () {
    return {};
  });
  var setInitialValues = match$1[1];
  var initialValues = match$1[0];
  var match$2 = React.useState(function () {
    return /* Select_processor */ 0;
  });
  var setConnectorConfigureState = match$2[1];
  var match$3 = React.useState(function () {
    return /* PLUGIN_INSTALL */ 0;
  });
  var setStepInView = match$3[1];
  var stepInView = match$3[0];
  var match$4 = React.useContext(GlobalProvider.defaultContext);
  var setDashboardPageState = match$4.setDashboardPageState;
  var match$5 = React.useState(function () {
    return /* Normal */ 0;
  });
  var buttonState = match$5[0];
  var connectorName = ConnectorUtils.getConnectorNameString(selectedConnector);
  var activeBusinessProfile = MerchantAccountUtils.getValueFromBusinessProfile(
    Recoil.useRecoilValue(HyperswitchAtom.businessProfilesAtom),
  );
  var naviagteToHome = function (param) {
    Curry._1(setDashboardPageState, function (param) {
      return "HOME";
    });
    RescriptReactRouter.replace(HSwitchGlobalVars.appendDashboardPath("/home"));
  };
  var handleNavigation = async function (forward) {
    var enums = QuickStartUtils.getTypedValueFromDict(
      LogicUtils.safeParse(enumDetails),
    );
    var isAnyConnectorConfigured = LogicUtils.isNonEmptyString(
      enums.firstProcessorConnected.processorID,
    );
    try {
      if (
        !(forward && !WooCommerceUtils.enumToValueMapper(stepInView, enums))
      ) {
        return;
      }
      var currentStepVariant = WooCommerceUtils.variantToEnumMapper(stepInView);
      await Curry._2(
        usePostEnumDetails,
        {
          TAG: /* Boolean */ 4,
          _0: true,
        },
        currentStepVariant,
      );
      return Curry._1(setStepInView, function (prev) {
        switch (prev) {
          case /* PLUGIN_INSTALL */ 0:
            if (forward) {
              return /* PLUGIN_CONFIGURE */ 1;
            } else {
              return /* PLUGIN_INSTALL */ 0;
            }
          case /* PLUGIN_CONFIGURE */ 1:
            if (forward) {
              return /* WEBHOOK_SETUP */ 2;
            } else {
              return /* PLUGIN_INSTALL */ 0;
            }
          case /* WEBHOOK_SETUP */ 2:
            if (forward && isAnyConnectorConfigured) {
              return /* COMPLETED_WOOCOMMERCE */ 4;
            } else if (forward) {
              return /* PROCESSOR_SETUP */ 3;
            } else {
              return /* PLUGIN_CONFIGURE */ 1;
            }
          case /* PROCESSOR_SETUP */ 3:
            if (forward) {
              return /* PROCESSOR_SETUP */ 3;
            } else {
              return /* WEBHOOK_SETUP */ 2;
            }
          case /* COMPLETED_WOOCOMMERCE */ 4:
            return /* COMPLETED_WOOCOMMERCE */ 4;
        }
      });
    } catch (exn) {
      return;
    }
  };
  React.useEffect(
    function () {
      var enums = QuickStartUtils.getTypedValueFromDict(
        LogicUtils.safeParse(enumDetails),
      );
      var currentPending = steps.find(function (step) {
        return WooCommerceUtils.enumToValueMapper(step, enums) === false;
      });
      if (currentPending !== undefined) {
        Curry._1(setStepInView, function (param) {
          return currentPending;
        });
      } else {
        Curry._1(setStepInView, function (param) {
          return /* COMPLETED_WOOCOMMERCE */ 4;
        });
      }
    },
    [enumDetails],
  );
  var match$6;
  switch (stepInView) {
    case /* PLUGIN_INSTALL */ 0:
      match$6 = [
        "Download and Install Plugin",
        "Start by downloading our Plugin, and installing it on your WordPress Admin Dashboard. Activate the Plugin post installation.",
      ];
      break;
    case /* PLUGIN_CONFIGURE */ 1:
      match$6 = [
        "Configure Plugin",
        "Configure our WooCommerce plugin details",
      ];
      break;
    case /* WEBHOOK_SETUP */ 2:
      match$6 = [
        "Setup Webhook & Save Changes",
        "Configure WooCommerce webhook on our end & complete setup",
      ];
      break;
    case /* PROCESSOR_SETUP */ 3:
    case /* COMPLETED_WOOCOMMERCE */ 4:
      match$6 = ["", ""];
      break;
  }
  var description = match$6[1];
  var title = match$6[0];
  React.useEffect(
    function () {
      var defaultJsonOnNewConnector = Object.fromEntries([
        ["profile_id", activeBusinessProfile.profile_id],
      ]);
      Curry._1(setInitialValues, function (param) {
        return defaultJsonOnNewConnector;
      });
    },
    [activeBusinessProfile.profile_id, connectorName],
  );
  var tmp;
  switch (stepInView) {
    case /* PLUGIN_INSTALL */ 0:
      tmp = React.createElement(WooCommerce$InstallPlugin, {
        handleNavigation: handleNavigation,
        title: title,
        description: description,
      });
      break;
    case /* PLUGIN_CONFIGURE */ 1:
      tmp = React.createElement(WooCommerce$ConfigurePlugin, {
        handleNavigation: handleNavigation,
        title: title,
        description: description,
      });
      break;
    case /* WEBHOOK_SETUP */ 2:
      tmp = React.createElement(WooCommerce$ConfigureWebHook, {
        handleNavigation: handleNavigation,
        title: title,
        description: description,
      });
      break;
    case /* PROCESSOR_SETUP */ 3:
      switch (match$2[0]) {
        case /* Select_processor */ 0:
          tmp = React.createElement(WooCommerceUIUtils.SelectProcessor.make, {
            setSelectedConnector: match[1],
            selectedConnector: selectedConnector,
            setConnectorConfigureState: setConnectorConfigureState,
            connectorArray: [],
          });
          break;
        case /* Select_configuration_type */ 1:
          tmp = null;
          break;
        case /* Configure_keys */ 2:
          tmp = React.createElement(SetupConnector.ConfigureProcessor.make, {
            selectedConnector: selectedConnector,
            initialValues: initialValues,
            setInitialValues: setInitialValues,
            setConnectorConfigureState: setConnectorConfigureState,
          });
          break;
        case /* Setup_payment_methods */ 3:
          tmp = React.createElement(
            WooCommerceUIUtils.SelectPaymentMethods.make,
            {
              selectedConnector: selectedConnector,
              initialValues: initialValues,
              setInitialValues: setInitialValues,
              setConnectorConfigureState: setConnectorConfigureState,
              setButtonState: match$5[1],
              buttonState: buttonState,
            },
          );
          break;
        case /* Summary */ 4:
          tmp = React.createElement(QuickStartUIUtils.BaseComponent.make, {
            children: React.createElement(
              ConnectorPreview.ConnectorSummaryGrid.make,
              {
                connectorInfo: ConnectorListMapper.getProcessorPayloadType(
                  LogicUtils.getDictFromJsonObject(initialValues),
                ),
                connector: connectorName,
                isPayoutFlow: false,
                setScreenState: function (param) {},
              },
            ),
            headerText: LogicUtils.capitalizeString(connectorName),
            nextButton: Caml_option.some(
              React.createElement(Button.make, {
                buttonState: buttonState,
                text: "Continue & Proceed",
                buttonType: /* Primary */ 0,
                buttonSize: /* Small */ 2,
                onClick: function (param) {
                  handleNavigation(true);
                },
                customButtonStyle: "rounded-md",
              }),
            ),
            backButton: Caml_option.some(
              React.createElement(Button.make, {
                text: "Back",
                buttonType: /* PrimaryOutline */ 2,
                onClick: function (param) {
                  handleNavigation(false);
                },
              }),
            ),
            customIcon: Caml_option.some(
              React.createElement(GatewayIcon.make, {
                gateway: connectorName.toUpperCase(),
                className: "w-6 h-6 rounded-md",
              }),
            ),
            customCss: "show-scrollbar",
          });
          break;
      }
      break;
    case /* COMPLETED_WOOCOMMERCE */ 4:
      tmp = React.createElement(
        "div",
        {
          className: "bg-white rounded h-40-rem",
        },
        React.createElement(
          ProdOnboardingUIUtils.BasicAccountSetupSuccessfulPage.make,
          {
            iconName: "account-setup-completed",
            statusText: "WooCommerce Plugin Setup Successfully Completed",
            buttonText: "Go To Home",
            buttonOnClick: naviagteToHome,
            customWidth: "w-30-rem text-center",
          },
        ),
      );
      break;
  }
  return React.createElement(
    "div",
    {
      className: "flex bg-blue-background_blue",
    },
    React.createElement(HSSelfServeSidebar.make, {
      heading: "Hyperswitch for Woocommerce",
      sidebarOptions:
        WooCommerceUtils.getSidebarOptionsForWooCommerceIntegration(
          enumDetails,
          stepInView,
        ),
    }),
    React.createElement(
      "div",
      {
        className: "flex-1 flex flex-col items-center justify-center ml-12",
      },
      tmp,
    ),
  );
}

var make = WooCommerce;

export {
  steps,
  BaseComponent,
  WooCommerceStepWrapper,
  InstallPlugin,
  ConfigurePlugin,
  ConfigureWebHook,
  make,
};
/* react Not a pure module */
