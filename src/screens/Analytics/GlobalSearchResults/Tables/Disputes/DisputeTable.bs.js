// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Recoil from "recoil";
import * as APIUtils from "../../../../APIUtils/APIUtils.bs.js";
import * as UrlUtils from "../../../../../utils/UrlUtils.bs.js";
import * as PageUtils from "../../../../Utils/PageUtils.bs.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as LogicUtils from "../../../../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.bs.js";
import * as LoadedTable from "../../../../../components/LoadedTable.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as PageLoaderWrapper from "../../../../Utils/PageLoaderWrapper.bs.js";
import * as ResultsTableUtils from "../ResultsTableUtils.bs.js";
import * as DisputeTableEntity from "./DisputeTableEntity.bs.js";

function DisputeTable$PreviewTable(props) {
  var match = React.useState(function () {
    return 0;
  });
  var tableData = props.data
    .map(function (item) {
      var data = Core__Option.getOr(item.texts[0], {});
      return Core__Option.getOr(Core__JSON.Decode.object(data), {});
    })
    .filter(function (dict) {
      return Object.keys(dict).length > 0;
    })
    .map(DisputeTableEntity.tableItemToObjMapper);
  return React.createElement(LoadedTable.make, {
    visibleColumns: DisputeTableEntity.visibleColumns,
    defaultSort: {
      key: "",
      order: /* INC */ 0,
    },
    title: " ",
    actualData: tableData,
    totalResults: tableData.length,
    resultsPerPage: 10,
    offset: match[0],
    setOffset: match[1],
    entity: DisputeTableEntity.tableEntity,
    currrentFetchCount: tableData.length,
    hideTitle: true,
    ignoreHeaderBg: true,
    tableLocalFilter: false,
    tableheadingClass: ResultsTableUtils.tableBorderClass,
    tableBorderClass: ResultsTableUtils.tableBorderClass,
    tableDataBorderClass: ResultsTableUtils.tableBorderClass,
    isAnalyticsModule: false,
    paginationClass: "hidden",
    showResultsPerPageSelector: false,
  });
}

var PreviewTable = {
  make: DisputeTable$PreviewTable,
};

function DisputeTable(props) {
  var updateDetails = APIUtils.useUpdateMethod(undefined, undefined);
  var fetchTableData = ResultsTableUtils.useGetData(undefined);
  var match = React.useState(function () {
    return /* Loading */ 0;
  });
  var setScreenState = match[1];
  var match$1 = React.useState(function () {
    return [];
  });
  var setData = match$1[1];
  var data = match$1[0];
  var match$2 = React.useState(function () {
    return 0;
  });
  var setTotalCount = match$2[1];
  var pageDetailDict = Recoil.useRecoilValue(LoadedTable.table_pageDetails);
  var pageDetail = Core__Option.getOr(pageDetailDict["Orders"], {
    offset: 0,
    resultsPerPage: 10,
  });
  var match$3 = React.useState(function () {
    return pageDetail.offset;
  });
  var setOffset = match$3[1];
  var offset = match$3[0];
  var searchText = LogicUtils.getString(
    UrlUtils.useGetFilterDictFromUrl(""),
    "query",
    "",
  );
  var getData = async function (param) {
    Curry._1(setScreenState, function (param) {
      return /* Loading */ 0;
    });
    try {
      var match = await Curry._4(
        fetchTableData,
        updateDetails,
        offset,
        searchText,
        "disputes",
      );
      var total = match[1];
      var arr = Core__Array.make(offset, {});
      if (total <= offset) {
        Curry._1(setOffset, function (param) {
          return 0;
        });
      }
      if (total <= 0) {
        return Curry._1(setScreenState, function (param) {
          return /* Custom */ 2;
        });
      }
      var dataDictArr = Belt_Array.keepMap(match[0], Core__JSON.Decode.object);
      var orderData = arr
        .concat(dataDictArr)
        .map(DisputeTableEntity.tableItemToObjMapper);
      var list = orderData.map(function (prim) {
        return prim;
      });
      Curry._1(setTotalCount, function (param) {
        return total;
      });
      Curry._1(setData, function (param) {
        return list;
      });
      return Curry._1(setScreenState, function (param) {
        return /* Success */ 1;
      });
    } catch (exn) {
      return Curry._1(setScreenState, function (param) {
        return /* Error */ {
          _0: "Something went wrong!",
        };
      });
    }
  };
  React.useEffect(
    function () {
      if (searchText.length > 0) {
        getData(undefined);
      } else {
        Curry._1(setScreenState, function (param) {
          return /* Success */ 1;
        });
      }
    },
    [offset, searchText],
  );
  return React.createElement(
    "div",
    {
      className: "flex flex-col mx-auto h-full w-full  min-h-[50vh]",
    },
    React.createElement(PageUtils.PageHeading.make, {
      title: "Disputes",
    }),
    React.createElement(PageLoaderWrapper.make, {
      children: Caml_option.some(
        React.createElement(LoadedTable.make, {
          visibleColumns: DisputeTableEntity.visibleColumns,
          title: " ",
          showSerialNumber: true,
          actualData: data,
          totalResults: match$2[0],
          resultsPerPage: 10,
          offset: offset,
          setOffset: setOffset,
          entity: DisputeTableEntity.tableEntity,
          currrentFetchCount: data.length,
          hideTitle: true,
          ignoreHeaderBg: true,
          tableLocalFilter: false,
          tableheadingClass: ResultsTableUtils.tableBorderClass,
          tableBorderClass: ResultsTableUtils.tableBorderClass,
          tableDataBorderClass: ResultsTableUtils.tableBorderClass,
          isAnalyticsModule: false,
          showResultsPerPageSelector: false,
        }),
      ),
      screenState: match[0],
    }),
  );
}

var make = DisputeTable;

export { PreviewTable, make };
/* react Not a pure module */
