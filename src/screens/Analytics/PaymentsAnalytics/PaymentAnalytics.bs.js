// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Js_exn from "rescript/lib/es6/js_exn.js";
import * as Recoil from "recoil";
import * as APIUtils from "../../APIUtils/APIUtils.bs.js";
import * as Analytics from "../Analytics.bs.js";
import * as LogicUtils from "../../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as HyperswitchAtom from "../../../Recoils/HyperswitchAtom.bs.js";
import * as HSAnalyticsUtils from "../HSAnalyticsUtils.bs.js";
import * as PageLoaderWrapper from "../../Utils/PageLoaderWrapper.bs.js";
import * as Caml_js_exceptions from "rescript/lib/es6/caml_js_exceptions.js";
import * as JsxPPXReactSupport from "rescript/lib/es6/jsxPPXReactSupport.js";
import * as PaymentAnalyticsEntity from "./PaymentAnalyticsEntity.bs.js";

function PaymentAnalytics(props) {
  var match = React.useState(function () {
    return /* Loading */ 0;
  });
  var setScreenState = match[1];
  var match$1 = React.useState(function () {
    return [];
  });
  var setMetrics = match$1[1];
  var metrics = match$1[0];
  var match$2 = React.useState(function () {
    return [];
  });
  var setDimensions = match$2[1];
  var fetchDetails = APIUtils.useGetMethod(undefined, undefined);
  var match$3 = Recoil.useRecoilValue(HyperswitchAtom.featureFlagAtom);
  var loadInfo = async function (param) {
    try {
      var infoUrl = APIUtils.getURL(
        /* ANALYTICS_PAYMENTS */ 6,
        /* Get */ 0,
        Caml_option.some(PaymentAnalyticsEntity.domain),
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var infoDetails = await Curry._1(fetchDetails, infoUrl);
      Curry._1(setMetrics, function (param) {
        return LogicUtils.getArrayFromDict(
          LogicUtils.getDictFromJsonObject(infoDetails),
          "metrics",
          [],
        );
      });
      Curry._1(setDimensions, function (param) {
        return LogicUtils.getArrayFromDict(
          LogicUtils.getDictFromJsonObject(infoDetails),
          "dimensions",
          [],
        );
      });
      return Curry._1(setScreenState, function (param) {
        return /* Success */ 1;
      });
    } catch (raw_e) {
      var e = Caml_js_exceptions.internalToOCamlException(raw_e);
      if (e.RE_EXN_ID === Js_exn.$$Error) {
        var err = Core__Option.getOr(e._1.message, "Failed to Fetch!");
        return Curry._1(setScreenState, function (param) {
          return /* Error */ {
            _0: err,
          };
        });
      }
      throw e;
    }
  };
  var getPaymetsDetails = async function (param) {
    try {
      Curry._1(setScreenState, function (param) {
        return /* Loading */ 0;
      });
      var paymentUrl = APIUtils.getURL(
        /* ORDERS */ 13,
        /* Get */ 0,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var paymentDetails = await Curry._1(fetchDetails, paymentUrl);
      var data = LogicUtils.getArrayFromDict(
        LogicUtils.getDictFromJsonObject(paymentDetails),
        "data",
        [],
      );
      if (data.length < 0) {
        return Curry._1(setScreenState, function (param) {
          return /* Custom */ 2;
        });
      } else {
        return await loadInfo(undefined);
      }
    } catch (raw_e) {
      var e = Caml_js_exceptions.internalToOCamlException(raw_e);
      if (e.RE_EXN_ID === Js_exn.$$Error) {
        var err = Core__Option.getOr(e._1.message, "Failed to Fetch!");
        return Curry._1(setScreenState, function (param) {
          return /* Error */ {
            _0: err,
          };
        });
      }
      throw e;
    }
  };
  React.useEffect(function () {
    getPaymetsDetails(undefined);
  }, []);
  var tabKeys = HSAnalyticsUtils.getStringListFromArrayDict(match$2[0]);
  var tabValues = tabKeys.map(function (key, index) {
    return {
      title: LogicUtils.snakeToTitle(key),
      value: key,
      isRemovable: index > 2,
    };
  });
  var title = "Payments Analytics";
  var subTitle =
    "Gain Insights, monitor performance and make Informed Decisions with Payment Analytics.";
  return React.createElement(PageLoaderWrapper.make, {
    children: Caml_option.some(
      JsxPPXReactSupport.createElementWithKey(
        "PaymentsAnalytics",
        Analytics.make,
        {
          pageTitle: title,
          pageSubTitle: subTitle,
          startTimeFilterKey: HSAnalyticsUtils.startTimeFilterKey,
          endTimeFilterKey: HSAnalyticsUtils.endTimeFilterKey,
          chartEntity: {
            default: PaymentAnalyticsEntity.chartEntity(tabKeys),
          },
          defaultSort: "total_volume",
          tabKeys: tabKeys,
          tabValues: tabValues,
          initialFilters: HSAnalyticsUtils.initialFilterFields,
          initialFixedFilters: HSAnalyticsUtils.initialFixedFilterFields,
          options: HSAnalyticsUtils.options,
          getTable: PaymentAnalyticsEntity.getPaymentTable,
          colMapper: PaymentAnalyticsEntity.colMapper,
          tableEntity: PaymentAnalyticsEntity.paymentTableEntity(undefined),
          deltaMetrics: HSAnalyticsUtils.getStringListFromArrayDict(metrics),
          deltaArray: [],
          singleStatEntity: PaymentAnalyticsEntity.getSingleStatEntity(
            metrics,
            !match$3.isLiveMode,
          ),
          filterUri:
            "" +
            window._env_.apiBaseUrl +
            "/analytics/v1/filters/" +
            PaymentAnalyticsEntity.domain +
            "",
          tableUpdatedHeading: PaymentAnalyticsEntity.getUpdatedHeading,
          tableGlobalFilter: HSAnalyticsUtils.filterByData,
          moduleName: "Payments",
          weeklyTableMetricsCols: PaymentAnalyticsEntity.weeklyTableMetricsCols,
          distributionArray: Caml_option.some([
            PaymentAnalyticsEntity.distribution,
          ]),
          generateReportType: /* PAYMENT_REPORT */ 31,
        },
      ),
    ),
    screenState: match[0],
    customUI: Caml_option.some(
      React.createElement(HSAnalyticsUtils.NoData.make, {
        title: title,
        subTitle: subTitle,
      }),
    ),
  });
}

var make = PaymentAnalytics;

export { make };
/* react Not a pure module */
