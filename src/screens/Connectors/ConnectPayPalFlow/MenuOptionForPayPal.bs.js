// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Icon from "../../../components/Icon.bs.js";
import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Js_exn from "rescript/lib/es6/js_exn.js";
import * as Navbar from "../../../components/Navbar.bs.js";
import * as Recoil from "recoil";
import * as UIUtils from "../../../utils/UIUtils.bs.js";
import * as PopUpState from "../../../hooks/PopUpState.bs.js";
import * as ToastState from "../../../hooks/ToastState.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as ConnectorUtils from "../ConnectorUtils.bs.js";
import * as HyperswitchAtom from "../../../Recoils/HyperswitchAtom.bs.js";
import * as PayPalFlowUtils from "./PayPalFlowUtils.bs.js";
import * as React$1 from "@headlessui/react";
import * as Caml_js_exceptions from "rescript/lib/es6/caml_js_exceptions.js";
import * as ConnectorListMapper from "../../../utils/Mappers/ConnectorListMapper.bs.js";

function MenuOptionForPayPal(props) {
  var setInitialValues = props.setInitialValues;
  var isUpdateFlow = props.isUpdateFlow;
  var setScreenState = props.setScreenState;
  var connectorInfoDict = props.connectorInfoDict;
  var isConnectorDisabled = props.isConnectorDisabled;
  var disableConnector = props.disableConnector;
  var setCurrentStep = props.setCurrentStep;
  var updateStepValue = props.updateStepValue;
  var updateStepValue$1 =
    updateStepValue !== undefined ? updateStepValue : /* IntegFields */ 0;
  var showPopUp = PopUpState.useShowPopUp(undefined);
  var showToast = ToastState.useShowToast(undefined);
  var deleteTrackingDetails =
    PayPalFlowUtils.useDeleteTrackingDetails(undefined);
  var updateConnectorAccountDetails =
    PayPalFlowUtils.useDeleteConnectorAccountDetails(undefined);
  var setSetupAccountStatus = Recoil.useSetRecoilState(
    HyperswitchAtom.paypalAccountStatusAtom,
  );
  var connectorInfo =
    ConnectorListMapper.getProcessorPayloadType(connectorInfoDict);
  var connectorStatusAvailableToSwitch = isConnectorDisabled
    ? "Enable"
    : "Disable";
  var updateConnectorAuthType = async function (values) {
    try {
      Curry._1(setScreenState, function (param) {
        return /* Loading */ 0;
      });
      var res = await Curry._6(
        updateConnectorAccountDetails,
        values,
        connectorInfo.merchant_connector_id,
        connectorInfo.connector_name,
        isUpdateFlow,
        true,
        "inactive",
      );
      Curry._1(setInitialValues, function (param) {
        return res;
      });
      return Curry._1(setScreenState, function (param) {
        return /* Success */ 1;
      });
    } catch (raw_e) {
      var e = Caml_js_exceptions.internalToOCamlException(raw_e);
      if (e.RE_EXN_ID === Js_exn.$$Error) {
        return Js_exn.raiseError(
          Core__Option.getOr(e._1.message, "Something went wrong!"),
        );
      }
      throw e;
    }
  };
  var handleNewPayPalAccount = async function (param) {
    try {
      await Curry._2(
        deleteTrackingDetails,
        connectorInfo.merchant_connector_id,
        connectorInfo.connector_name,
      );
      await updateConnectorAuthType(connectorInfoDict);
      Curry._1(setCurrentStep, function (param) {
        return /* AutomaticFlow */ 4;
      });
      return setSetupAccountStatus(function (param) {
        return /* Redirecting_to_paypal */ 1;
      });
    } catch (raw_e) {
      var e = Caml_js_exceptions.internalToOCamlException(raw_e);
      if (e.RE_EXN_ID === Js_exn.$$Error) {
        var err = Core__Option.getOr(e._1.message, "Something went wrong!");
        return Curry._8(
          showToast,
          err,
          /* ToastError */ 0,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      }
      throw e;
    }
  };
  var popupForNewPayPalAccount = function (param) {
    Curry._1(showPopUp, {
      heading: "Confirm Action ?",
      description: "By changing this the old account details will be lost ",
      popUpType: [/* Warning */ 4, /* WithIcon */ 0],
      handleCancel: {
        text: "Cancel",
      },
      handleConfirm: {
        text: "Confirm",
        onClick: function (param) {
          handleNewPayPalAccount(undefined);
        },
      },
    });
  };
  return React.createElement(React$1.Popover, {
    as: "div",
    className: "relative inline-block text-left",
    children: function (popoverProps) {
      return React.createElement(
        React.Fragment,
        undefined,
        React.createElement(React$1.Popover.Button, {
          children: function (buttonProps) {
            return React.createElement(Icon.make, {
              name: "menu-option",
              size: 28,
            });
          },
        }),
        React.createElement(React$1.Popover.Panel, {
          className: "absolute z-20 right-0 top-10",
          children: function (panelProps) {
            return React.createElement(
              "div",
              {
                className:
                  "relative flex flex-col bg-white py-3 overflow-hidden rounded ring-1 ring-black ring-opacity-5 w-max",
                id: "neglectTopbarTheme",
              },
              React.createElement(
                React.Fragment,
                undefined,
                React.createElement(UIUtils.RenderIf.make, {
                  condition:
                    ConnectorUtils.mapAuthType(
                      connectorInfo.connector_account_details.auth_type,
                    ) === "SignatureKey",
                  children: React.createElement(Navbar.MenuOption.make, {
                    text: "Create new PayPal account",
                    onClick: function (param) {
                      popupForNewPayPalAccount(undefined);
                      Curry._1(panelProps.close, undefined);
                    },
                  }),
                }),
                React.createElement(Navbar.MenuOption.make, {
                  text: "Change configurations",
                  onClick: function (param) {
                    Curry._1(setCurrentStep, function (param) {
                      return /* AutomaticFlow */ 4;
                    });
                    setSetupAccountStatus(function (param) {
                      return /* Connect_paypal_landing */ 0;
                    });
                  },
                }),
                React.createElement(UIUtils.RenderIf.make, {
                  condition:
                    ConnectorUtils.mapAuthType(
                      connectorInfo.connector_account_details.auth_type,
                    ) === "BodyKey",
                  children: React.createElement(Navbar.MenuOption.make, {
                    text: "Update",
                    onClick: function (param) {
                      Curry._1(setCurrentStep, function (param) {
                        return /* IntegFields */ 0;
                      });
                      setSetupAccountStatus(function (param) {
                        return /* Manual_setup_flow */ 2;
                      });
                    },
                  }),
                }),
                React.createElement(UIUtils.RenderIf.make, {
                  condition:
                    ConnectorUtils.mapAuthType(
                      connectorInfo.connector_account_details.auth_type,
                    ) === "SignatureKey",
                  children: React.createElement(Navbar.MenuOption.make, {
                    text: "Update Payment Methods",
                    onClick: function (param) {
                      Curry._1(setCurrentStep, function (param) {
                        return updateStepValue$1;
                      });
                    },
                  }),
                }),
                React.createElement(Navbar.MenuOption.make, {
                  text: connectorStatusAvailableToSwitch,
                  onClick: function (param) {
                    Curry._1(panelProps.close, undefined);
                    Curry._1(showPopUp, {
                      heading: "Confirm Action ? ",
                      description:
                        "You are about to " +
                        (isConnectorDisabled
                          ? "Enable"
                          : "Disable".toLowerCase()) +
                        " this connector. This might impact your desired routing configurations. Please confirm to proceed.",
                      popUpType: [/* Warning */ 4, /* WithIcon */ 0],
                      handleCancel: {
                        text: "Cancel",
                      },
                      handleConfirm: {
                        text: "Confirm",
                        onClick: function (param) {
                          Curry._1(disableConnector, isConnectorDisabled);
                        },
                      },
                    });
                  },
                }),
              ),
            );
          },
        }),
      );
    },
  });
}

var make = MenuOptionForPayPal;

export { make };
/* Icon Not a pure module */
