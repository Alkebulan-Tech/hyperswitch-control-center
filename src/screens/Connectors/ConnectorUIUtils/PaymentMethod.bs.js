// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Icon from "../../../components/Icon.bs.js";
import * as Curry from "rescript/lib/es6/curry.js";
import * as Modal from "../../../utils/Modal.bs.js";
import * as React from "react";
import * as Wallet from "../Wallets/Wallet.bs.js";
import * as UIUtils from "../../../utils/UIUtils.bs.js";
import * as BoolInput from "../../../components/form/BoolInput.bs.js";
import * as LogicUtils from "../../../utils/LogicUtils.bs.js";
import * as CheckBoxIcon from "../../../components/custom-icons/CheckBoxIcon.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as HSwitchUtils from "../../Utils/HSwitchUtils.bs.js";
import * as ConfigContext from "../../../context/ConfigContext.bs.js";
import * as ConnectorUtils from "../ConnectorUtils.bs.js";
import * as Caml_splice_call from "rescript/lib/es6/caml_splice_call.js";
import * as AddDataAttributes from "../../../components/AddDataAttributes.bs.js";

function isSelectedAll(
  selectedPaymentMethod,
  allPaymentMethods,
  paymentMethod,
) {
  var paymentMethodObj = ConnectorUtils.getSelectedPaymentObj(
    selectedPaymentMethod,
    paymentMethod,
  );
  var match = ConnectorUtils.getPaymentMethodFromString(paymentMethod);
  if (match === 0) {
    return (
      Core__Option.getOr(paymentMethodObj.card_provider, []).length ===
      allPaymentMethods.length
    );
  } else {
    return (
      Core__Option.getOr(paymentMethodObj.provider, []).length ===
      allPaymentMethods.length
    );
  }
}

function PaymentMethod$CardRenderer(props) {
  var connector = props.connector;
  var provider = props.provider;
  var paymentMethod = props.paymentMethod;
  var paymentMethodsEnabled = props.paymentMethodsEnabled;
  var updateDetails = props.updateDetails;
  var match = React.useContext(ConfigContext.configContext);
  var match$1 = React.useState(function () {
    return false;
  });
  var setShowWalletConfigurationModal = match$1[1];
  var showWalletConfigurationModal = match$1[0];
  var match$2 = React.useState(function () {
    return ConnectorUtils.itemProviderMapper({});
  });
  var setSelectedWallet = match$2[1];
  var selectedWallet = match$2[0];
  var selectedAll = isSelectedAll(
    paymentMethodsEnabled,
    provider,
    paymentMethod,
  );
  var paymentObj = ConnectorUtils.getSelectedPaymentObj(
    paymentMethodsEnabled,
    paymentMethod,
  );
  var standardProviders = Core__Option.getOr(
    paymentObj.provider,
    ConnectorUtils.getPaymentMethodMapper([]),
  );
  var cardProviders = Core__Option.getOr(
    paymentObj.card_provider,
    ConnectorUtils.getPaymentMethodMapper([]),
  );
  var checkPaymentMethodType = function (obj, selectedMethod) {
    return obj.payment_method_type === selectedMethod.payment_method_type;
  };
  var removeOrAddMethods = function (method) {
    var match = ConnectorUtils.getPaymentMethodFromString(paymentMethod);
    if (match === 0) {
      if (
        cardProviders.some(function (obj) {
          return checkPaymentMethodType(obj, method);
        })
      ) {
        return Curry._1(
          updateDetails,
          ConnectorUtils.removeMethod(
            paymentMethodsEnabled,
            paymentMethod,
            method,
          ),
        );
      } else {
        return Curry._1(
          updateDetails,
          ConnectorUtils.addMethod(
            paymentMethodsEnabled,
            paymentMethod,
            method,
          ),
        );
      }
    }
    if (
      standardProviders.some(function (obj) {
        return checkPaymentMethodType(obj, method);
      })
    ) {
      return Curry._1(
        updateDetails,
        ConnectorUtils.removeMethod(
          paymentMethodsEnabled,
          paymentMethod,
          method,
        ),
      );
    }
    var methodVariant = ConnectorUtils.getPaymentMethodTypeFromString(
      method.payment_method_type,
    );
    var tmp = false;
    if (
      methodVariant === /* GooglePay */ 2 ||
      methodVariant === /* ApplePay */ 3
    ) {
      var match$1 = ConnectorUtils.getConnectorNameTypeFromString(
        connector,
        undefined,
        undefined,
      );
      var tmp$1;
      switch (match$1.TAG | 0) {
        case /* Processors */ 0:
          var match$2 = match$1._0;
          tmp$1 =
            match$2 > 24 || match$2 < 10
              ? match$2 !== 44
              : !(match$2 > 23 || match$2 < 11);
          break;
        case /* ThreeDsAuthenticator */ 1:
        case /* UnknownConnector */ 2:
          tmp$1 = true;
          break;
      }
      tmp = tmp$1;
    }
    if (tmp) {
      Curry._1(setShowWalletConfigurationModal, function (param) {
        return !showWalletConfigurationModal;
      });
      return Curry._1(setSelectedWallet, function (param) {
        return method;
      });
    } else {
      return Curry._1(
        updateDetails,
        ConnectorUtils.addMethod(paymentMethodsEnabled, paymentMethod, method),
      );
    }
  };
  var isSelected = function (selectedMethod) {
    if (
      standardProviders.some(function (obj) {
        return checkPaymentMethodType(obj, selectedMethod);
      })
    ) {
      return true;
    } else {
      return cardProviders.some(function (obj) {
        return checkPaymentMethodType(obj, selectedMethod);
      });
    }
  };
  var isNotVerifiablePaymentMethod = function (paymentMethodVariant) {
    if (typeof paymentMethodVariant === "number") {
      return true;
    } else {
      return paymentMethodVariant._0 !== "is_verifiable";
    }
  };
  var p2RegularTextStyle =
    "" +
    HSwitchUtils.getTextClass([/* P2 */ 4, /* Medium */ 1]) +
    " text-grey-700 opacity-50";
  var tmp = false;
  if (
    ConnectorUtils.getPaymentMethodFromString(paymentMethod) === /* Wallet */ 2
  ) {
    var match$3 = ConnectorUtils.getConnectorNameTypeFromString(
      connector,
      undefined,
      undefined,
    );
    var tmp$1;
    switch (match$3.TAG | 0) {
      case /* Processors */ 0:
        tmp$1 = match$3._0 === 25;
        break;
      case /* ThreeDsAuthenticator */ 1:
      case /* UnknownConnector */ 2:
        tmp$1 = false;
        break;
    }
    tmp = tmp$1;
  }
  return React.createElement(
    "div",
    {
      className: "flex flex-col gap-4 border rounded-md p-6",
    },
    React.createElement(
      "div",
      undefined,
      React.createElement(UIUtils.RenderIf.make, {
        condition: isNotVerifiablePaymentMethod(
          ConnectorUtils.getPaymentMethodFromString(paymentMethod),
        ),
        children: React.createElement(
          "div",
          {
            className:
              "flex items-center border-b gap-2 py-2 break-all justify-between",
          },
          React.createElement(
            "p",
            {
              className: "font-semibold text-bold text-lg",
            },
            LogicUtils.snakeToTitle(paymentMethod),
          ),
          React.createElement(UIUtils.RenderIf.make, {
            condition:
              ConnectorUtils.getPaymentMethodFromString(paymentMethod) !==
              /* Wallet */ 2,
            children: React.createElement(AddDataAttributes.make, {
              attributes: [
                ["data-testid", paymentMethod.concat("_").concat("select_all")],
              ],
              children: React.createElement(
                "div",
                {
                  className: "flex gap-2 items-center",
                },
                React.createElement(BoolInput.BaseComponent.make, {
                  isSelected: selectedAll,
                  setIsSelected: function (param) {
                    var arr = selectedAll ? [] : provider;
                    paymentMethodsEnabled.forEach(function (val) {
                      if (val.payment_method_type !== paymentMethod) {
                        return;
                      }
                      var match =
                        ConnectorUtils.getPaymentMethodTypeFromString(
                          paymentMethod,
                        );
                      if (typeof match === "number" && match < 2) {
                        var length = Core__Option.getOr(
                          val.card_provider,
                          [],
                        ).length;
                        Caml_splice_call.spliceObjApply(
                          Core__Option.getOr(val.card_provider, []),
                          "splice",
                          [0, length, arr],
                        );
                        return;
                      }
                      var length$1 = Core__Option.getOr(
                        val.provider,
                        [],
                      ).length;
                      Caml_splice_call.spliceObjApply(
                        Core__Option.getOr(val.provider, []),
                        "splice",
                        [0, length$1, arr],
                      );
                    });
                    Curry._1(updateDetails, paymentMethodsEnabled);
                  },
                  isDisabled: false,
                  boolCustomClass: "rounded-lg",
                }),
                React.createElement(
                  "p",
                  {
                    className: p2RegularTextStyle,
                  },
                  "Select all",
                ),
              ),
            }),
          }),
        ),
      }),
    ),
    React.createElement(UIUtils.RenderIf.make, {
      condition: tmp,
      children: React.createElement(
        "div",
        {
          className: "border rounded p-2 bg-jp-gray-100 flex gap-4",
        },
        React.createElement(Icon.make, {
          name: "outage_icon",
          size: 15,
        }),
        "Zen doesn't support Googlepay and Applepay in sandbox.",
      ),
    }),
    React.createElement(
      "div",
      {
        className:
          "grid " +
          (props._showAdvancedConfiguration ? "grid-cols-2" : "grid-cols-4") +
          " gap-4",
      },
      provider.map(function (value, i) {
        return React.createElement(
          "div",
          {
            key: i.toString(),
          },
          React.createElement(
            "div",
            {
              className: "flex",
            },
            React.createElement(AddDataAttributes.make, {
              attributes: [
                [
                  "data-testid",
                  "" +
                    paymentMethod
                      .concat("_")
                      .concat(value.payment_method_type)
                      .toLowerCase() +
                    "",
                ],
              ],
              children: React.createElement(
                "div",
                {
                  className: "flex items-center gap-2",
                },
                React.createElement(
                  "div",
                  {
                    className: "cursor-pointer",
                    onClick: function (param) {
                      removeOrAddMethods(value);
                    },
                  },
                  React.createElement(CheckBoxIcon.make, {
                    isSelected: isSelected(value),
                  }),
                ),
                React.createElement(
                  "p",
                  {
                    className: "" + p2RegularTextStyle + " cursor-pointer",
                    onClick: function (param) {
                      removeOrAddMethods(value);
                    },
                  },
                  LogicUtils.snakeToTitle(value.payment_method_type),
                ),
              ),
            }),
          ),
        );
      }),
      React.createElement(UIUtils.RenderIf.make, {
        condition:
          ConnectorUtils.getPaymentMethodTypeFromString(
            selectedWallet.payment_method_type,
          ) === /* ApplePay */ 3 ||
          ConnectorUtils.getPaymentMethodTypeFromString(
            selectedWallet.payment_method_type,
          ) === /* GooglePay */ 2,
        children: React.createElement(Modal.make, {
          showModal: showWalletConfigurationModal,
          setShowModal: setShowWalletConfigurationModal,
          children: React.createElement(Wallet.Wallets.make, {
            method: selectedWallet,
            metaData: props.metaData,
            setMetaData: props.setMetaData,
            setShowWalletConfigurationModal: setShowWalletConfigurationModal,
            updateDetails: updateDetails,
            paymentMethodsEnabled: paymentMethodsEnabled,
            paymentMethod: paymentMethod,
          }),
          modalHeading:
            "Additional Details to enable " +
            LogicUtils.snakeToTitle(selectedWallet.payment_method_type) +
            "",
          modalClass:
            "w-full md:w-1/3 !h-full overflow-y-scroll !overflow-x-hidden rounded-none text-jp-gray-900",
          childClass: "",
          paddingClass: "",
          headerTextClass:
            "" +
            match.globalUIConfig.font.textColor.primaryNormal +
            " font-bold text-xl",
          revealFrom: /* Right */ 1,
        }),
      }),
    ),
  );
}

var CardRenderer = {
  make: PaymentMethod$CardRenderer,
};

function PaymentMethod$PaymentMethodsRender(props) {
  var isPayoutFlow = props.isPayoutFlow;
  var setMetaData = props.setMetaData;
  var metaData = props.metaData;
  var updateDetails = props.updateDetails;
  var paymentMethodsEnabled = props.paymentMethodsEnabled;
  var connector = props.connector;
  var pmts = React.useMemo(
    function () {
      return LogicUtils.getDictFromJsonObject(
        isPayoutFlow
          ? window.getPayoutConnectorConfig(connector)
          : window.getConnectorConfig(connector),
      );
    },
    [connector],
  );
  var keys = Object.keys(pmts).filter(function (val) {
    return !ConnectorUtils.configKeysToIgnore.includes(val);
  });
  return React.createElement(
    "div",
    {
      className: "flex flex-col gap-12",
    },
    keys.map(function (value, i) {
      var provider = ConnectorUtils.getPaymentMethodMapper(
        LogicUtils.getArrayFromDict(pmts, value, []),
      );
      var match = ConnectorUtils.getPaymentMethodTypeFromString(value);
      if (typeof match === "number" && match < 2) {
        return React.createElement(
          "div",
          {
            key: i.toString(),
          },
          React.createElement(PaymentMethod$CardRenderer, {
            updateDetails: updateDetails,
            paymentMethodsEnabled: paymentMethodsEnabled,
            paymentMethod: value,
            provider: provider,
            _showAdvancedConfiguration: false,
            metaData: metaData,
            setMetaData: setMetaData,
            connector: connector,
          }),
        );
      }
      return React.createElement(
        "div",
        {
          key: i.toString(),
        },
        React.createElement(PaymentMethod$CardRenderer, {
          updateDetails: updateDetails,
          paymentMethodsEnabled: paymentMethodsEnabled,
          paymentMethod: value,
          provider: provider,
          _showAdvancedConfiguration: false,
          metaData: metaData,
          setMetaData: setMetaData,
          connector: connector,
        }),
      );
    }),
  );
}

var PaymentMethodsRender = {
  make: PaymentMethod$PaymentMethodsRender,
};

export { isSelectedAll, CardRenderer, PaymentMethodsRender };
/* Icon Not a pure module */
