// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Icon from "../Icon.bs.js";
import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Button from "../Button.bs.js";
import * as Portal from "../portal/Portal.bs.js";
import * as ToolTip from "../tooltip/ToolTip.bs.js";
import * as UIUtils from "../../utils/UIUtils.bs.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as LogicUtils from "../../utils/LogicUtils.bs.js";
import * as PopUpState from "../../hooks/PopUpState.bs.js";
import * as ButtonGroup from "../ButtonGroup.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as InputFields from "../InputFields.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as ErrorBoundary from "../ErrorBoundary.bs.js";
import * as FormErrorIcon from "../custom-icons/FormErrorIcon.bs.js";
import * as FormValuesSpy from "./FormValuesSpy.bs.js";
import * as ReactFinalForm from "../../libraries/ReactFinalForm.bs.js";
import * as JsonFlattenUtils from "../../utils/JsonFlattenUtils.bs.js";
import * as ReactFinalForm$1 from "react-final-form";
import * as AddDataAttributes from "../AddDataAttributes.bs.js";
import * as JsxPPXReactSupport from "rescript/lib/es6/jsxPPXReactSupport.js";
import * as LabelVisibilityContext from "./LabelVisibilityContext.bs.js";

function makeInputFieldInfo(
  label,
  name,
  customInput,
  placeholder,
  format,
  disabledOpt,
  parse,
  type_Opt,
  isRequiredOpt,
  validate,
  param,
) {
  var disabled = disabledOpt !== undefined ? disabledOpt : false;
  var type_ = type_Opt !== undefined ? type_Opt : "text";
  var isRequired = isRequiredOpt !== undefined ? isRequiredOpt : false;
  var label$1 = Core__Option.getOr(label, name);
  var arg = disabled;
  var newCustomInput = Core__Option.getOr(customInput, function (param) {
    return function (param$1) {
      var param$2;
      var param$3;
      var param$4;
      var param$5;
      var param$6;
      var param$7;
      var param$8;
      var param$9;
      var param$10;
      var param$11;
      var param$12;
      var param$13;
      var param$14;
      var param$15;
      var param$16;
      var param$17;
      var param$18;
      var param$19;
      var param$20;
      var param$21;
      var param$22;
      var param$23;
      var param$24;
      var param$25;
      var param$26;
      return InputFields.textInput(
        param,
        param$1,
        param$2,
        arg,
        param$3,
        param$4,
        param$5,
        param$6,
        param$7,
        param$8,
        param$9,
        param$10,
        param$11,
        param$12,
        param$13,
        param$14,
        param$15,
        param$16,
        param$17,
        param$18,
        param$19,
        param$20,
        param$21,
        param$22,
        param$23,
        param$24,
        param$25,
        param$26,
      );
    };
  });
  return {
    name: name,
    placeholder: Core__Option.getOr(placeholder, label$1),
    format: format,
    parse: parse,
    disabled: disabled,
    isRequired: isRequired,
    type: type_,
    customInput: newCustomInput,
    validate: validate,
  };
}

function makeMultiInputFieldInfoOld(
  label,
  customLabelIcon,
  subHeading,
  subHeadingIcon,
  description,
  toolTipPosition,
  descriptionComponent,
  subText,
  isRequiredOpt,
  comboCustomInput,
  inputFields,
  param,
) {
  var isRequired = isRequiredOpt !== undefined ? isRequiredOpt : false;
  return {
    label: label,
    customLabelIcon: customLabelIcon,
    subHeading: subHeading,
    subHeadingIcon: subHeadingIcon,
    description: description,
    descriptionComponent: descriptionComponent,
    subText: subText,
    isRequired: isRequired,
    toolTipPosition: toolTipPosition,
    comboCustomInput: comboCustomInput,
    inputFields: inputFields,
    inputNames: inputFields.map(function (x) {
      return x.name;
    }),
  };
}

function makeMultiInputFieldInfo(
  label,
  customLabelIcon,
  subHeading,
  subHeadingIcon,
  description,
  toolTipPosition,
  descriptionComponent,
  subText,
  isRequiredOpt,
  comboCustomInput,
  fieldPortalKey,
  inputFields,
  param,
) {
  var isRequired = isRequiredOpt !== undefined ? isRequiredOpt : false;
  var inputNames = Core__Option.mapOr(comboCustomInput, [], function (x) {
    return x.names;
  }).concat(
    inputFields.map(function (x) {
      return x.name;
    }),
  );
  return {
    label: label,
    customLabelIcon: customLabelIcon,
    subHeading: subHeading,
    subHeadingIcon: subHeadingIcon,
    description: description,
    descriptionComponent: descriptionComponent,
    subText: subText,
    isRequired: isRequired,
    toolTipPosition: toolTipPosition,
    comboCustomInput: Core__Option.map(comboCustomInput, function (x) {
      return x.fn;
    }),
    inputFields: inputFields,
    inputNames: inputNames,
    fieldPortalKey: fieldPortalKey,
  };
}

function makeFieldInfo(
  label,
  customLabelIcon,
  name,
  customInput,
  description,
  toolTipPosition,
  descriptionComponent,
  subText,
  placeholder,
  subHeading,
  subHeadingIcon,
  format,
  disabledOpt,
  parse,
  type_Opt,
  isRequiredOpt,
  fieldPortalKey,
  validate,
  param,
) {
  var disabled = disabledOpt !== undefined ? disabledOpt : false;
  var type_ = type_Opt !== undefined ? type_Opt : "text";
  var isRequired = isRequiredOpt !== undefined ? isRequiredOpt : false;
  var label$1 = Core__Option.getOr(label, name);
  var arg = disabled;
  var newCustomInput = Core__Option.getOr(customInput, function (param) {
    return function (param$1) {
      var param$2;
      var param$3;
      var param$4;
      var param$5;
      var param$6;
      var param$7;
      var param$8;
      var param$9;
      var param$10;
      var param$11;
      var param$12;
      var param$13;
      var param$14;
      var param$15;
      var param$16;
      var param$17;
      var param$18;
      var param$19;
      var param$20;
      var param$21;
      var param$22;
      var param$23;
      var param$24;
      var param$25;
      var param$26;
      return InputFields.textInput(
        param,
        param$1,
        param$2,
        arg,
        param$3,
        param$4,
        param$5,
        param$6,
        param$7,
        param$8,
        param$9,
        param$10,
        param$11,
        param$12,
        param$13,
        param$14,
        param$15,
        param$16,
        param$17,
        param$18,
        param$19,
        param$20,
        param$21,
        param$22,
        param$23,
        param$24,
        param$25,
        param$26,
      );
    };
  });
  return makeMultiInputFieldInfo(
    label$1,
    customLabelIcon,
    subHeading,
    subHeadingIcon,
    description,
    toolTipPosition,
    descriptionComponent,
    subText,
    isRequired,
    undefined,
    fieldPortalKey,
    [
      makeInputFieldInfo(
        label$1,
        name,
        newCustomInput,
        placeholder,
        format,
        disabled,
        parse,
        type_,
        isRequired,
        validate,
        undefined,
      ),
    ],
    undefined,
  );
}

function FormRenderer$FieldWrapper(props) {
  var subHeadingClass = props.subHeadingClass;
  var subTextClass = props.subTextClass;
  var dataId = props.dataId;
  var fieldWrapperClass = props.fieldWrapperClass;
  var isRequired = props.isRequired;
  var descriptionComponent = props.descriptionComponent;
  var toolTipPosition = props.toolTipPosition;
  var description = props.description;
  var subHeadingIcon = props.subHeadingIcon;
  var subHeading = props.subHeading;
  var labelPadding = props.labelPadding;
  var labelTextStyleClass = props.labelTextStyleClass;
  var labelClass = props.labelClass;
  var customLabelIcon = props.customLabelIcon;
  var label = props.label;
  var labelClass$1 = labelClass !== undefined ? labelClass : "";
  var labelTextStyleClass$1 =
    labelTextStyleClass !== undefined ? labelTextStyleClass : "";
  var labelPadding$1 = labelPadding !== undefined ? labelPadding : "";
  var toolTipPosition$1 =
    toolTipPosition !== undefined ? toolTipPosition : /* Bottom */ 1;
  var isRequired$1 = isRequired !== undefined ? isRequired : false;
  var fieldWrapperClass$1 =
    fieldWrapperClass !== undefined ? fieldWrapperClass : "";
  var dataId$1 = dataId !== undefined ? dataId : "";
  var subTextClass$1 = subTextClass !== undefined ? subTextClass : "";
  var subHeadingClass$1 = subHeadingClass !== undefined ? subHeadingClass : "";
  var showLabel = React.useContext(
    LabelVisibilityContext.formLabelRenderContext,
  );
  var fieldWrapperClass$2 = LogicUtils.isEmptyString(fieldWrapperClass$1)
    ? "p-1 flex flex-col"
    : fieldWrapperClass$1;
  var subTextClass$2 =
    "pt-2 pb-2 text-sm text-bold text-jp-gray-900 text-opacity-50 dark:text-jp-gray-text_darktheme dark:text-opacity-50 " +
    subTextClass$1 +
    "";
  var labelPadding$2 = LogicUtils.isEmptyString(labelPadding$1)
    ? "pt-2 pb-2"
    : labelPadding$1;
  var labelTextClass = LogicUtils.isNonEmptyString(labelTextStyleClass$1)
    ? labelTextStyleClass$1
    : "text-fs-13 text-jp-gray-900 dark:text-jp-gray-text_darktheme dark:text-opacity-50 ml-1";
  var subText = Core__Option.flatMap(
    props.subText,
    LogicUtils.getNonEmptyString,
  );
  return React.createElement(AddDataAttributes.make, {
    attributes: [["data-component-field-wrapper", "field-" + dataId$1 + ""]],
    children: React.createElement(
      "div",
      {
        className: fieldWrapperClass$2,
      },
      React.createElement(
        React.Fragment,
        undefined,
        React.createElement(
          "div",
          {
            className: "flex items-center",
          },
          React.createElement(UIUtils.RenderIf.make, {
            condition: showLabel,
            children: React.createElement(AddDataAttributes.make, {
              attributes: [["data-form-label", label]],
              children: React.createElement(
                "label",
                {
                  className:
                    "" +
                    labelPadding$2 +
                    " " +
                    labelTextClass +
                    " " +
                    labelClass$1 +
                    "",
                },
                label,
                React.createElement(UIUtils.RenderIf.make, {
                  condition: isRequired$1,
                  children: React.createElement(
                    "span",
                    {
                      className: "text-red-950",
                    },
                    " *",
                  ),
                }),
              ),
            }),
          }),
          description !== undefined
            ? React.createElement(UIUtils.RenderIf.make, {
                condition: LogicUtils.isNonEmptyString(description),
                children: React.createElement(
                  "div",
                  {
                    className: "text-sm text-gray-500 mx-2",
                  },
                  React.createElement(ToolTip.make, {
                    description: description,
                    toolTipPosition: toolTipPosition$1,
                  }),
                ),
              })
            : null,
          descriptionComponent !== undefined
            ? React.createElement(
                "div",
                {
                  className: "text-sm text-gray-500 mx-2",
                },
                React.createElement(ToolTip.make, {
                  descriptionComponent: Caml_option.some(
                    Caml_option.valFromOption(descriptionComponent),
                  ),
                  tooltipWidthClass: "w-80",
                  toolTipPosition: toolTipPosition$1,
                }),
              )
            : null,
          customLabelIcon !== undefined
            ? React.createElement(
                "div",
                {
                  className: "pl-2",
                },
                Caml_option.valFromOption(customLabelIcon),
              )
            : null,
        ),
        subHeading !== undefined
          ? React.createElement(
              "div",
              {
                className: "flex flex-row items-center",
              },
              subHeadingIcon !== undefined
                ? React.createElement(Icon.make, {
                    name: subHeadingIcon,
                    size: 13,
                    className: " opacity-60 mr-2 ml-1 mb-2",
                  })
                : null,
              React.createElement(
                "div",
                {
                  className:
                    "text-sm text-jp-gray-900 text-opacity-50 dark:text-jp-gray-text_darktheme dark:text-opacity-50 mb-2 " +
                    subHeadingClass$1 +
                    "",
                },
                subHeading,
              ),
            )
          : null,
      ),
      props.children,
      subText !== undefined
        ? React.createElement(
            "div",
            {
              className: subTextClass$2,
            },
            subText,
          )
        : null,
    ),
  });
}

var FieldWrapper = {
  make: FormRenderer$FieldWrapper,
};

function FormRenderer$FieldError(props) {
  var showErrorOnChange = props.showErrorOnChange;
  var errorClass = props.errorClass;
  var alwaysShow = props.alwaysShow;
  var meta = props.meta;
  var alwaysShow$1 = alwaysShow !== undefined ? alwaysShow : false;
  var errorClass$1 = errorClass !== undefined ? errorClass : "";
  var showErrorOnChange$1 =
    showErrorOnChange !== undefined ? showErrorOnChange : false;
  var error =
    meta.touched || alwaysShow$1 || (showErrorOnChange$1 && meta.modified)
      ? !(meta.submitError == null) && !meta.dirtySinceLastSubmit
        ? Caml_option.nullable_to_opt(meta.submitError)
        : Caml_option.nullable_to_opt(meta.error)
      : undefined;
  if (error !== undefined) {
    return React.createElement(AddDataAttributes.make, {
      attributes: [["data-form-error", error]],
      children: React.createElement(
        "div",
        {
          className:
            "flex flex-row items-center text-red-950 dark:text-red-400 text-fs-10 font-medium ml-1 pt-2 leading-4 text-start " +
            errorClass$1 +
            "",
        },
        React.createElement(FormErrorIcon.make, {}),
        error,
      ),
    });
  } else {
    return null;
  }
}

var FieldError = {
  make: FormRenderer$FieldError,
};

function FormRenderer$FieldErrorRenderer(props) {
  var errorClass = props.errorClass;
  var field = props.field;
  var errorClass$1 = errorClass !== undefined ? errorClass : "";
  return React.createElement(ReactFinalForm$1.Field, {
    name: field.name,
    render: function (param) {
      return React.createElement(FormRenderer$FieldError, {
        meta: param.meta,
        errorClass: errorClass$1,
      });
    },
    validate: field.validate,
  });
}

var FieldErrorRenderer = {
  make: FormRenderer$FieldErrorRenderer,
};

function FormRenderer$FieldInputRenderer(props) {
  var showErrorOnChange = props.showErrorOnChange;
  var errorClass = props.errorClass;
  var showError = props.showError;
  var customRender = props.customRender;
  var field = props.field;
  var showError$1 = showError !== undefined ? showError : true;
  var errorClass$1 = errorClass !== undefined ? errorClass : "";
  var showErrorOnChange$1 =
    showErrorOnChange !== undefined ? showErrorOnChange : false;
  return React.cloneElement(
    React.createElement(ReactFinalForm$1.Field, {
      format: field.format,
      name: field.name,
      parse: field.parse,
      render:
        customRender !== undefined
          ? customRender
          : function (param) {
              return React.createElement(
                React.Fragment,
                undefined,
                Curry._2(field.customInput, param.input, field.placeholder),
                showError$1
                  ? React.createElement(FormRenderer$FieldError, {
                      meta: param.meta,
                      errorClass: errorClass$1,
                      showErrorOnChange: showErrorOnChange$1,
                    })
                  : null,
              );
            },
      validate: field.validate,
    }),
    {
      type: field.type,
    },
  );
}

var FieldInputRenderer = {
  make: FormRenderer$FieldInputRenderer,
};

function FormRenderer$ComboFieldsRenderer(props) {
  var field = props.field;
  return React.createElement(
    "div",
    undefined,
    React.createElement(ButtonGroup.make, {
      children: field.inputFields.map(function (field, i) {
        return JsxPPXReactSupport.createElementWithKey(
          i.toString(),
          ErrorBoundary.make,
          {
            children: React.createElement(FormRenderer$FieldInputRenderer, {
              field: field,
              showError: false,
            }),
          },
        );
      }),
      wrapperClass: "flex flex-row items-center",
    }),
    React.createElement(
      "div",
      undefined,
      field.inputFields.map(function (field, i) {
        return JsxPPXReactSupport.createElementWithKey(
          i.toString(),
          ErrorBoundary.make,
          {
            children: React.createElement(FormRenderer$FieldErrorRenderer, {
              field: field,
            }),
          },
        );
      }),
    ),
  );
}

var ComboFieldsRenderer = {
  make: FormRenderer$ComboFieldsRenderer,
};

function FormRenderer$ComboFieldsRenderer3$ComboFieldsRecursive(props) {
  var renderComboFields = props.renderComboFields;
  var renderInputs = props.renderInputs;
  var fieldsState = props.fieldsState;
  var inputFields = props.inputFields;
  var fieldsState$1 = fieldsState !== undefined ? fieldsState : [];
  if (inputFields.length === 0) {
    return Curry._1(renderInputs, fieldsState$1);
  }
  var inputField = Core__Option.getOr(
    inputFields[0],
    makeInputFieldInfo(
      undefined,
      "",
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
    ),
  );
  var restInputFields = inputFields.slice(1);
  return React.createElement(ReactFinalForm$1.Field, {
    children: function (fieldState) {
      var newFieldsState = [].concat(fieldsState$1, [fieldState]);
      return Curry._3(
        renderComboFields,
        restInputFields,
        newFieldsState,
        renderInputs,
      );
    },
    format: inputField.format,
    name: inputField.name,
    parse: inputField.parse,
    validate: inputField.validate,
  });
}

var ComboFieldsRecursive = {
  make: FormRenderer$ComboFieldsRenderer3$ComboFieldsRecursive,
};

function renderComboFields(inputFields, fieldsState, renderInputs) {
  return React.createElement(
    FormRenderer$ComboFieldsRenderer3$ComboFieldsRecursive,
    {
      inputFields: inputFields,
      fieldsState: fieldsState,
      renderInputs: renderInputs,
      renderComboFields: renderComboFields,
    },
  );
}

function FormRenderer$ComboFieldsRenderer3(props) {
  var fieldsState = props.fieldsState;
  var fieldsState$1 = fieldsState !== undefined ? fieldsState : [];
  return React.createElement(
    FormRenderer$ComboFieldsRenderer3$ComboFieldsRecursive,
    {
      inputFields: props.inputFields,
      fieldsState: fieldsState$1,
      renderInputs: props.renderInputs,
      renderComboFields: renderComboFields,
    },
  );
}

var ComboFieldsRenderer3 = {
  ComboFieldsRecursive: ComboFieldsRecursive,
  renderComboFields: renderComboFields,
  make: FormRenderer$ComboFieldsRenderer3,
};

function FormRenderer$DesktopRow(props) {
  var backgroundColor = props.backgroundColor;
  var itemWrapperClass = props.itemWrapperClass;
  var wrapperClass = props.wrapperClass;
  var wrapperClass$1 = wrapperClass !== undefined ? wrapperClass : "";
  var itemWrapperClass$1 =
    itemWrapperClass !== undefined ? itemWrapperClass : "mx-4";
  var backgroundColor$1 = backgroundColor !== undefined ? backgroundColor : "";
  return React.createElement(
    "div",
    {
      className:
        "flex flex-col md:flex-row md:flex-wrap " +
        backgroundColor$1 +
        " " +
        wrapperClass$1 +
        "",
    },
    React.Children.map(props.children, function (element) {
      if (element !== null) {
        return React.createElement(AddDataAttributes.make, {
          attributes: [["data-component", "desktopRow"]],
          children: React.createElement(
            "div",
            {
              className: "flex-1 space-y-2 " + itemWrapperClass$1 + "",
            },
            element,
          ),
        });
      } else {
        return null;
      }
    }),
  );
}

var DesktopRow = {
  make: FormRenderer$DesktopRow,
};

function FormRenderer$FieldRenderer(props) {
  var showErrorOnChange = props.showErrorOnChange;
  var subHeadingClass = props.subHeadingClass;
  var subTextClass = props.subTextClass;
  var errorClass = props.errorClass;
  var labelPadding = props.labelPadding;
  var labelTextStyleClass = props.labelTextStyleClass;
  var labelClass = props.labelClass;
  var fieldWrapperClass = props.fieldWrapperClass;
  var field = props.field;
  var fieldWrapperClass$1 =
    fieldWrapperClass !== undefined ? fieldWrapperClass : "";
  var labelClass$1 = labelClass !== undefined ? labelClass : "";
  var labelTextStyleClass$1 =
    labelTextStyleClass !== undefined ? labelTextStyleClass : "";
  var labelPadding$1 = labelPadding !== undefined ? labelPadding : "";
  var errorClass$1 = errorClass !== undefined ? errorClass : "";
  var subTextClass$1 = subTextClass !== undefined ? subTextClass : "";
  var subHeadingClass$1 = subHeadingClass !== undefined ? subHeadingClass : "";
  var showErrorOnChange$1 =
    showErrorOnChange !== undefined ? showErrorOnChange : false;
  var names = field.inputNames.join("-");
  var tmp;
  if (field.inputFields.length === 1) {
    var field$1 = Core__Option.getOr(
      field.inputFields[0],
      makeInputFieldInfo(
        undefined,
        "",
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      ),
    );
    tmp = React.createElement(ErrorBoundary.make, {
      children: React.createElement(FormRenderer$FieldInputRenderer, {
        field: field$1,
        errorClass: errorClass$1,
        showErrorOnChange: showErrorOnChange$1,
      }),
    });
  } else {
    var renderInputs = field.comboCustomInput;
    tmp =
      renderInputs !== undefined
        ? React.createElement(FormRenderer$ComboFieldsRenderer3, {
            inputFields: field.inputFields,
            renderInputs: renderInputs,
          })
        : React.createElement(FormRenderer$ComboFieldsRenderer, {
            field: field,
          });
  }
  return React.createElement(Portal.make, {
    to: "",
    children: React.createElement(AddDataAttributes.make, {
      attributes: [["data-component", "fieldRenderer"]],
      children: React.createElement(ErrorBoundary.make, {
        children: React.createElement(FormRenderer$FieldWrapper, {
          label: field.label,
          customLabelIcon: field.customLabelIcon,
          labelClass: labelClass$1,
          labelTextStyleClass: labelTextStyleClass$1,
          labelPadding: labelPadding$1,
          subHeading: field.subHeading,
          subHeadingIcon: field.subHeadingIcon,
          description: field.description,
          toolTipPosition: field.toolTipPosition,
          descriptionComponent: field.descriptionComponent,
          subText: field.subText,
          isRequired: field.isRequired,
          fieldWrapperClass: fieldWrapperClass$1,
          children: tmp,
          dataId: names,
          subTextClass: subTextClass$1,
          subHeadingClass: subHeadingClass$1,
        }),
      }),
    }),
  });
}

var FieldRenderer = {
  make: FormRenderer$FieldRenderer,
};

function FormRenderer$FormError(props) {
  var form = props.form;
  var match = React.useState(function () {});
  var setSubmitErrors = match[1];
  var submitErrors = match[0];
  var subscriptionDict = {};
  subscriptionDict["submitErrors"] = true;
  React.useEffect(function () {
    return Curry._2(
      form.subscribe,
      function (formState) {
        Curry._1(setSubmitErrors, function (param) {
          return Caml_option.nullable_to_opt(formState.submitErrors);
        });
      },
      subscriptionDict,
    );
  }, []);
  if (submitErrors === undefined) {
    return null;
  }
  var dict = Core__JSON.Decode.object(Caml_option.valFromOption(submitErrors));
  if (dict === undefined) {
    return null;
  }
  var err = Caml_option.valFromOption(dict)["FORM_ERROR"];
  var errStr =
    err !== undefined
      ? LogicUtils.getStringFromJson(Caml_option.valFromOption(err), "")
      : "Error occurred on submit";
  return React.createElement(
    "div",
    {
      className: "text-red-950",
    },
    errStr,
  );
}

var FormError = {
  make: FormRenderer$FormError,
};

function FormRenderer$SubmitButton(props) {
  var dataTestId = props.dataTestId;
  var textStyle = props.textStyle;
  var userInteractionRequired = props.userInteractionRequired;
  var tooltipForHeight = props.tooltipForHeight;
  var tooltipForWidthClass = props.tooltipForWidthClass;
  var tooltipWidthClass = props.tooltipWidthClass;
  var modalObj = props.modalObj;
  var withDialog = props.withDialog;
  var tooltipPositioning = props.tooltipPositioning;
  var toolTipPosition = props.toolTipPosition;
  var buttonSize = props.buttonSize;
  var loadingText = props.loadingText;
  var buttonType = props.buttonType;
  var showToolTip = props.showToolTip;
  var customSumbitButtonStyle = props.customSumbitButtonStyle;
  var loginPageValidator = props.loginPageValidator;
  var rightIcon = props.rightIcon;
  var icon = props.icon;
  var disabledParamter = props.disabledParamter;
  var text = props.text;
  var text$1 = text !== undefined ? text : "Submit";
  var disabledParamter$1 =
    disabledParamter !== undefined ? disabledParamter : false;
  var icon$1 = icon !== undefined ? icon : /* NoIcon */ 0;
  var rightIcon$1 = rightIcon !== undefined ? rightIcon : /* NoIcon */ 0;
  var loginPageValidator$1 =
    loginPageValidator !== undefined ? loginPageValidator : false;
  var customSumbitButtonStyle$1 =
    customSumbitButtonStyle !== undefined ? customSumbitButtonStyle : "";
  var showToolTip$1 = showToolTip !== undefined ? showToolTip : true;
  var buttonType$1 = buttonType !== undefined ? buttonType : /* Primary */ 0;
  var loadingText$1 = loadingText !== undefined ? loadingText : "";
  var toolTipPosition$1 =
    toolTipPosition !== undefined ? toolTipPosition : /* Top */ 0;
  var tooltipPositioning$1 =
    tooltipPositioning !== undefined ? tooltipPositioning : "fixed";
  var withDialog$1 = withDialog !== undefined ? withDialog : false;
  var tooltipWidthClass$1 =
    tooltipWidthClass !== undefined ? tooltipWidthClass : "w-64";
  var tooltipForWidthClass$1 =
    tooltipForWidthClass !== undefined ? tooltipForWidthClass : "";
  var tooltipForHeight$1 =
    tooltipForHeight !== undefined ? tooltipForHeight : "h-full";
  var userInteractionRequired$1 =
    userInteractionRequired !== undefined ? userInteractionRequired : false;
  var dict = {};
  [
    "hasSubmitErrors",
    "hasValidationErrors",
    "errors",
    "submitErrors",
    "submitting",
  ].forEach(function (item) {
    dict[item] = true;
  });
  var formState = ReactFinalForm$1.useFormState(dict);
  var submitting = formState.submitting;
  var hasValidationErrors = formState.hasValidationErrors;
  var errorsList = Object.entries(
    JsonFlattenUtils.flattenObject(formState.errors, false),
  );
  var hasError = loginPageValidator$1
    ? hasValidationErrors
    : (hasValidationErrors || formState.hasSubmitErrors || submitting) &&
      !formState.dirtySinceLastSubmit;
  var disabled = hasError || disabledParamter$1;
  var showPopUp = PopUpState.useShowPopUp(undefined);
  var match = React.useState(function () {
    return userInteractionRequired$1;
  });
  var setAvoidDisable = match[1];
  var avoidDisable = match[0];
  React.useEffect(function () {
    var onClick = function (_ev) {
      Curry._1(setAvoidDisable, function (param) {
        return false;
      });
    };
    window.addEventListener("click", onClick);
    return function (param) {
      window.removeEventListener("click", onClick);
    };
  }, []);
  var form = ReactFinalForm$1.useForm();
  var popUpBtn = React.createElement(Button.make, {
    buttonState: disabled ? /* Disabled */ 2 : /* Normal */ 0,
    text: text$1,
    buttonType: buttonType$1,
    buttonSize: buttonSize,
    leftIcon: icon$1,
    rightIcon: rightIcon$1,
    onClick: function (param) {
      if (!disabled && modalObj !== undefined) {
        var confirmType = modalObj.confirmType;
        var confirmText = modalObj.confirmText;
        var buttonText = modalObj.buttonText;
        var cancelButtonText = modalObj.cancelButtonText;
        var popUpType = modalObj.popUpType;
        return Curry._1(showPopUp, {
          heading: confirmType,
          description: confirmText,
          popUpType: [popUpType, /* WithIcon */ 0],
          handleCancel: {
            text: cancelButtonText,
          },
          handleConfirm: {
            text: buttonText,
            onClick: function (param) {
              Curry._1(form.submit, undefined);
            },
          },
        });
      }
    },
    textStyle: textStyle,
    customTextSize: props.customTextSize,
    textWeight: props.textWeight,
    customButtonStyle: customSumbitButtonStyle$1,
    customPaddingClass: props.customPaddingClass,
    dataTestId: dataTestId,
  });
  var buttonState =
    LogicUtils.isNonEmptyString(loadingText$1) && submitting
      ? /* Loading */ 1
      : !avoidDisable && disabled
        ? /* Disabled */ 2
        : /* Normal */ 0;
  var submitBtn = React.createElement(
    React.Fragment,
    undefined,
    React.createElement("button", {
      className: "hidden",
      type: "submit",
    }),
    React.createElement(Button.make, {
      loadingText: loadingText$1,
      buttonState: buttonState,
      text: text$1,
      buttonType: buttonType$1,
      buttonSize: buttonSize,
      leftIcon: icon$1,
      rightIcon: rightIcon$1,
      onClick: function (_ev) {
        Curry._1(form.submit, undefined);
      },
      textStyle: textStyle,
      customButtonStyle: customSumbitButtonStyle$1,
      customHeightClass: props.customHeightClass,
      dataTestId: dataTestId,
    }),
  );
  var button = withDialog$1 ? popUpBtn : submitBtn;
  if (errorsList.length === 0) {
    return button;
  }
  var description = errorsList
    .map(function (entry) {
      var value = LogicUtils.getStringFromJson(entry[1], "Error");
      return "" + LogicUtils.snakeToTitle(entry[0]) + ": " + value + "";
    })
    .join("\n");
  if (showToolTip$1 && !avoidDisable) {
    return React.createElement(ToolTip.make, {
      description: description,
      tooltipPositioning: tooltipPositioning$1,
      toolTipFor: Caml_option.some(button),
      tooltipWidthClass: tooltipWidthClass$1,
      tooltipForWidthClass: tooltipForWidthClass$1,
      toolTipPosition: toolTipPosition$1,
      height: tooltipForHeight$1,
    });
  } else {
    return button;
  }
}

var SubmitButton = {
  make: FormRenderer$SubmitButton,
};

function FormRenderer$FieldsRenderer(props) {
  var subHeadingClass = props.subHeadingClass;
  var subTextClass = props.subTextClass;
  var errorClass = props.errorClass;
  var labelPadding = props.labelPadding;
  var labelClass = props.labelClass;
  var fieldWrapperClass = props.fieldWrapperClass;
  var fieldWrapperClass$1 =
    fieldWrapperClass !== undefined ? fieldWrapperClass : "";
  var labelClass$1 = labelClass !== undefined ? labelClass : "";
  var labelPadding$1 = labelPadding !== undefined ? labelPadding : "";
  var errorClass$1 = errorClass !== undefined ? errorClass : "";
  var subTextClass$1 = subTextClass !== undefined ? subTextClass : "";
  var subHeadingClass$1 = subHeadingClass !== undefined ? subHeadingClass : "";
  return props.fields.map(function (field, i) {
    return JsxPPXReactSupport.createElementWithKey(
      i.toString(),
      FormRenderer$FieldRenderer,
      {
        field: field,
        fieldWrapperClass: fieldWrapperClass$1,
        labelClass: labelClass$1,
        labelPadding: labelPadding$1,
        errorClass: errorClass$1,
        subTextClass: subTextClass$1,
        subHeadingClass: subHeadingClass$1,
      },
    );
  });
}

var FieldsRenderer = {
  make: FormRenderer$FieldsRenderer,
};

function FormRenderer$FormContent(props) {
  var showFormSpy = props.showFormSpy;
  var formClass = props.formClass;
  var fieldWrapperClass = props.fieldWrapperClass;
  var fieldsWrapperClass = props.fieldsWrapperClass;
  var fields = props.fields;
  var title = props.title;
  var fieldsWrapperClass$1 =
    fieldsWrapperClass !== undefined ? fieldsWrapperClass : "";
  var fieldWrapperClass$1 =
    fieldWrapperClass !== undefined ? fieldWrapperClass : "";
  var formClass$1 = formClass !== undefined ? formClass : "";
  var showFormSpy$1 = showFormSpy !== undefined ? showFormSpy : false;
  return React.createElement(
    "form",
    {
      onSubmit: props.handleSubmit,
    },
    React.createElement(
      "div",
      {
        className: formClass$1,
      },
      title !== undefined ? React.createElement("div", undefined, title) : null,
      React.createElement(
        "div",
        {
          className: "p-2 " + fieldsWrapperClass$1 + "",
        },
        showFormSpy$1
          ? React.createElement(
              "div",
              {
                className: "flex flex-1 flex-row overflow-hidden",
              },
              React.createElement(
                "div",
                {
                  className: "flex flex-1 flex-col overflow-scroll p-4",
                },
                React.createElement(FormRenderer$FieldsRenderer, {
                  fields: fields,
                  fieldWrapperClass: fieldWrapperClass$1,
                }),
              ),
              React.createElement(FormValuesSpy.make, {
                wrapperClass: "h-full w-1/3",
                restrictToLocal: false,
              }),
            )
          : React.createElement(FormRenderer$FieldsRenderer, {
              fields: fields,
              fieldWrapperClass: fieldWrapperClass$1,
            }),
      ),
      React.createElement(
        "div",
        {
          className: "p-3",
        },
        React.createElement(FormRenderer$FormError, {
          form: props.form,
        }),
      ),
      React.createElement(
        "div",
        {
          className: "flex justify-center mb-2",
        },
        React.createElement(FormRenderer$SubmitButton, {
          text: props.submitButtonText,
        }),
      ),
    ),
  );
}

var FormContent = {
  make: FormRenderer$FormContent,
};

function FormRenderer(props) {
  var showFormSpy = props.showFormSpy;
  var formClass = props.formClass;
  var fieldWrapperClass = props.fieldWrapperClass;
  var fieldsWrapperClass = props.fieldsWrapperClass;
  var submitButtonText = props.submitButtonText;
  var fields = props.fields;
  var title = props.title;
  var fieldsWrapperClass$1 =
    fieldsWrapperClass !== undefined ? fieldsWrapperClass : "";
  var fieldWrapperClass$1 =
    fieldWrapperClass !== undefined ? fieldWrapperClass : "";
  var formClass$1 = formClass !== undefined ? formClass : "";
  var showFormSpy$1 = showFormSpy !== undefined ? showFormSpy : false;
  return React.createElement(ReactFinalForm$1.Form, {
    initialValues: Caml_option.some(props.initialValues),
    onSubmit: props.onSubmit,
    render: function (param) {
      return React.createElement(FormRenderer$FormContent, {
        form: param.form,
        title: title,
        fields: fields,
        handleSubmit: param.handleSubmit,
        fieldsWrapperClass: fieldsWrapperClass$1,
        fieldWrapperClass: fieldWrapperClass$1,
        formClass: formClass$1,
        showFormSpy: showFormSpy$1,
        submitButtonText: submitButtonText,
      });
    },
    subscription: ReactFinalForm.subscribeToValues,
    validate: props.validate,
  });
}

var make = FormRenderer;

export {
  makeInputFieldInfo,
  makeMultiInputFieldInfoOld,
  makeMultiInputFieldInfo,
  makeFieldInfo,
  FieldWrapper,
  FieldError,
  FieldErrorRenderer,
  FieldInputRenderer,
  ComboFieldsRenderer,
  ComboFieldsRenderer3,
  DesktopRow,
  FieldRenderer,
  FormError,
  SubmitButton,
  FieldsRenderer,
  FormContent,
  make,
};
/* Icon Not a pure module */
